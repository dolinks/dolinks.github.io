var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);a.prototype=t.prototype,e.prototype=new a},BaseElement=function(){function e(){this.type=""}return e}();__reflect(BaseElement.prototype,"BaseElement");var LevelRequireElement=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.num=0,t}return __extends(t,e),t}(BaseElement);__reflect(LevelRequireElement.prototype,"LevelRequireElement");var GameData=function(){function e(){}return e.initData=function(){e.mapData=new Array;for(var t=0;t<e.MaxRow;t++){var a=new Array;e.mapData.push(a);for(var i=0;i<e.MaxColumn;i++)e.mapData[t].push(-2)}e.levelreq=new LevelRequire,e.elements=new Array,e.unuseeElements=new Array;for(var n,s=e.MaxColumn*e.MaxRow,r=0;s>r;r++)n=new GameElement,n.id=r,e.elements.push(n),e.unuseeElements.push(r);e.stageW=egret.MainContext.instance.stage.stageWidth,e.stageH=egret.MainContext.instance.stage.stageHeight},e.unmapnum=0,e.stepNum=0,e.levelStepNum=0,e.levelBackgrouindImageName="",e.MaxRow=8,e.MaxColumn=8,e.currentElementNum=0,e.stageW=0,e.stageH=0,e}();__reflect(GameData.prototype,"GameData");var LevelGameDataParse=function(){function e(){}return e.parseLevelGameData=function(t){GameData.stepNum=t.step,GameData.levelStepNum=t.step,GameData.elementTyps=t.element,GameData.levelBackgrouindImageName=t.levelbgimg,e.parseLevelReq(t.levelreq)},e.parseLevelReq=function(e){GameData.levelreq.openChange();for(var t=e.length,a=0;t>a;a++)GameData.levelreq.addElement(e[a].type,e[a].num)},e}();__reflect(LevelGameDataParse.prototype,"LevelGameDataParse");var LevelRequire=function(){function e(){this.reqElements=new Array}return e.prototype.getLevelReqNum=function(){return this.reqElements.length},e.prototype.addElement=function(e,t){var a=new LevelRequireElement;a.num=t,a.type=e,this.reqElements.push(a)},e.prototype.openChange=function(){this.reqElements=[]},e.prototype.changeReqNum=function(e,t){for(var a=this.getLevelReqNum(),i=0;a>i;i++)if(this.reqElements[i].type==e)return this.reqElements[i].num-=t,void console.log("最新数量",this.reqElements[i].num)},e.prototype.isClear=function(){for(var e=this.getLevelReqNum(),t=0;e>t;t++)if(this.reqElements[t].num>0)return!1;return!0},e}();__reflect(LevelRequire.prototype,"LevelRequire");var LinkLogic=function(){function e(){}return e.isHaveLine=function(){e.lines=new Array;for(var t="",a=0,i=0;i<GameData.MaxRow;i++){for(var n=0;n<GameData.MaxColumn;n++)if(-1!=GameData.mapData[i][n])if(t!=GameData.elements[GameData.mapData[i][n]].type){if(a>=3){for(var s=new Array,r=0;a>r;r++)s.push(GameData.mapData[i][n-r-1]),console.log("横压入数组",i,n-r-1,GameData.mapData[i][n-r-1]);e.lines.push(s)}t=GameData.elements[GameData.mapData[i][n]].type,a=1}else a++;else{if(a>=3){for(var s=new Array,r=0;a>r;r++)s.push(GameData.mapData[i][n-r-1]),console.log("横压入数组",i,n-r-1,GameData.mapData[i][n-r-1]);e.lines.push(s)}t="",a=0}if(a>=3){for(var s=new Array,r=0;a>r;r++)console.log("横压入数组2",i,n-r-1,GameData.mapData[i][n-r-1]),s.push(GameData.mapData[i][n-r-1]);e.lines.push(s)}t="",a=0}for(i=0;i<GameData.MaxRow;i++){for(n=0;n<GameData.MaxColumn;n++)if(-1!=GameData.mapData[n][i])if(t!=GameData.elements[GameData.mapData[n][i]].type){if(a>=3){var s=new Array;for(r=0;a>r;r++)s.push(GameData.mapData[n-r-1][i]),console.log("纵压入数组",i,n-r-1,GameData.mapData[i][n-r-1]);e.lines.push(s)}t=GameData.elements[GameData.mapData[n][i]].type,a=1}else a++;else{if(a>=3){var s=new Array;for(r=0;a>r;r++)s.push(GameData.mapData[n-r-1][i]),console.log("纵压入数组",i,n-r-1,GameData.mapData[i][n-r-1]);e.lines.push(s)}t="",a=0}if(a>=3){for(var s=new Array,r=0;a>r;r++)console.log("2纵压入数组",i,n-r-1,GameData.mapData[i][n-r-1]),s.push(GameData.mapData[n-r-1][i]);e.lines.push(s)}t="",a=0}return 0!=e.lines.length?(console.log("未过滤数组",e.lines),!0):!1},e.isHaveLineByIndex=function(t,a){var i=GameData.mapData[Math.floor(t/GameData.MaxColumn)][t%GameData.MaxRow],n=GameData.mapData[Math.floor(a/GameData.MaxColumn)][a%GameData.MaxRow];GameData.mapData[Math.floor(t/GameData.MaxColumn)][t%GameData.MaxRow]=n,GameData.mapData[Math.floor(a/GameData.MaxColumn)][a%GameData.MaxRow]=i;var s=e.isHaveLine();return s?(GameData.elements[i].location=a,GameData.elements[n].location=t,!0):(GameData.mapData[Math.floor(t/GameData.MaxColumn)][t%GameData.MaxRow]=i,GameData.mapData[Math.floor(a/GameData.MaxColumn)][a%GameData.MaxRow]=n,!1)},e.changeOrder=function(){for(var e=new Array,t=0;t<GameData.MaxRow;t++)for(var a=0;a<GameData.MaxColumn;a++)-1!=GameData.mapData[t][a]&&e.push(GameData.mapData[t][a]);var i=0;for(t=0;t<GameData.MaxRow;t++)for(a=0;a<GameData.MaxColumn;a++)-1!=GameData.mapData[t][a]&&(i=Math.floor(Math.random()*e.length),GameData.mapData[t][a]=e[i],GameData.elements[e[i]].location=t*GameData.MaxColumn+a,e.splice(i,1))},e.isNextHaveLine=function(){for(var e=0;e<GameData.MaxRow;e++)for(var t=0;t<GameData.MaxColumn;t++)if(-1!=GameData.mapData[e][t]){if(t<GameData.MaxColumn-1&&-1!=GameData.mapData[e][t+1]&&GameData.elements[GameData.mapData[e][t]].type==GameData.elements[GameData.mapData[e][t+1]].type){if(t>0&&-1!=GameData.mapData[e][t-1]){if(e>0&&t>0&&GameData.mapData[e-1][t-1]&&-1!=GameData.mapData[e-1][t-1]&&GameData.elements[GameData.mapData[e-1][t-1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目1！！！",e,t),!0;if(e<GameData.MaxRow-1&&t>0&&GameData.mapData[e+1][t-1]&&-1!=GameData.mapData[e+1][t-1]&&GameData.elements[GameData.mapData[e+1][t-1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目2！！！",e,t),!0;if(t>1&&GameData.mapData[e][t-2]&&-1!=GameData.mapData[e][t-2]&&GameData.elements[GameData.mapData[e][t-2]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目3！！！",e,t),!0}if(t<GameData.MaxColumn-1&&-1!=GameData.mapData[e][t+2]){if(t<GameData.MaxColumn-2&&e>0&&GameData.mapData[e-1][t+2]&&-1!=GameData.mapData[e-1][t+2]&&GameData.elements[GameData.mapData[e-1][t+2]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目4！！！",e,t),!0;if(t<GameData.MaxColumn-2&&e<GameData.MaxRow-1&&GameData.mapData[e+1][t+2]&&-1!=GameData.mapData[e+1][t+2]&&GameData.elements[GameData.mapData[e+1][t+2]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目5！！！",e,t),!0;if(t<GameData.MaxColumn-3&&GameData.mapData[e][t+3]&&-1!=GameData.mapData[e][t+3]&&GameData.elements[GameData.mapData[e][t+3]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-1能消除项目6！！！",e,t),!0}}if(e<GameData.MaxRow-1&&-1!=GameData.mapData[e+1][t]&&GameData.elements[GameData.mapData[e][t]].type==GameData.elements[GameData.mapData[e+1][t]].type){if(e>0&&-1!=GameData.mapData[e-1][t]){if(e>1&&GameData.mapData[e-2][t]&&-1!=GameData.mapData[e-2][t]&&GameData.elements[GameData.mapData[e-2][t]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目1！！！",e,t),!0;if(e>0&&t>0&&GameData.mapData[e-1][t-1]&&-1!=GameData.mapData[e-1][t-1]&&GameData.elements[GameData.mapData[e-1][t-1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目2！！！",e,t),!0;if(e>0&&t<GameData.MaxColumn-1&&GameData.mapData[e-1][t+1]&&-1!=GameData.mapData[e-1][t+1]&&GameData.elements[GameData.mapData[e-1][t+1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目3！！！",e,t),!0}if(e<GameData.MaxRow-2&&-1!=GameData.mapData[e+2][t]){if(e<GameData.MaxRow-3&&GameData.mapData[e+3][t]&&-1!=GameData.mapData[e+3][t]&&GameData.elements[GameData.mapData[e+3][t]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目4！！！",e,t),!0;if(t<GameData.MaxColumn-2&&GameData.mapData[e+2][t+1]&&-1!=GameData.mapData[e+2][t+1]&&GameData.elements[GameData.mapData[e+2][t+1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目5！！！",e,t),!0;if(t>0&&GameData.mapData[e+2][t-1]&&-1!=GameData.mapData[e+2][t-1]&&GameData.elements[GameData.mapData[e+2][t-1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|1能消除项目6！！！",e,t),!0}}if(t<GameData.MaxColumn-2&&-1!=GameData.mapData[e][t+2]&&GameData.elements[GameData.mapData[e][t]].type==GameData.elements[GameData.mapData[e][t+2]].type&&-1!=GameData.mapData[e][t+1]){if(e>0&&GameData.mapData[e-1][t+1]&&-1!=GameData.mapData[e-1][t+1]&&GameData.elements[GameData.mapData[e-1][t+1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-2能消除项目1！！！",e,t),!0;if(e<GameData.MaxRow-1&&GameData.mapData[e+1][t+1]&&-1!=GameData.mapData[e+1][t+1]&&GameData.elements[GameData.mapData[e+1][t+1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("-2能消除项目2！！！",e,t),!0}if(e<GameData.MaxRow-2&&-1!=GameData.mapData[e+2][t]&&GameData.elements[GameData.mapData[e][t]].type==GameData.elements[GameData.mapData[e+2][t]].type&&-1!=GameData.mapData[e+1][t]){if(t<GameData.MaxColumn-1&&GameData.mapData[e+1][t+1]&&-1!=GameData.mapData[e+1][t+1]&&GameData.elements[GameData.mapData[e+1][t+1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|2能消除项目1！！！",e,t),!0;if(e<GameData.MaxRow-1&&t>0&&GameData.mapData[e+1][t-1]&&-1!=GameData.mapData[e+1][t-1]&&GameData.elements[GameData.mapData[e+1][t-1]].type==GameData.elements[GameData.mapData[e][t]].type)return console.log("|2能消除项目2！！！",e,t),!0}}return!1},e.canMove=function(e,t){var a=Math.floor(GameData.elements[e].location/GameData.MaxRow),i=GameData.elements[e].location%GameData.MaxColumn,n=Math.floor(GameData.elements[t].location/GameData.MaxRow),s=GameData.elements[t].location%GameData.MaxColumn;if(console.log("判断两点互换位置",e,GameData.elements[e].location,a,i,"第二个",t,GameData.elements[t].location,n,s),a==n){if(i-s==1||i-s==-1)return!0}else if(i==s&&(a-n==1||a-n==-1))return!0;return!1},e}();__reflect(LinkLogic.prototype,"LinkLogic");var MapControl=function(){function e(){}return e.prototype.createElementAllMap=function(){this.createAllMap()},e.prototype.createElements=function(e){return this.createElementByNumber(e)},e.prototype.createElementByNumber=function(e){for(var t=new Array,a=0;e>a;a++)t.push(this.createType());return t},e.prototype.createAllMap=function(){for(var e=(GameData.MaxColumn*GameData.MaxRow,""),t=!0,a=0,i="",n="",s=0;s<GameData.MaxRow;s++)for(var r=0;r<GameData.MaxColumn;r++)if(-1!=GameData.mapData[s][r]){for(;t;)e=this.createType(),s>1&&-1!=GameData.mapData[s-1][r]&&-1!=GameData.mapData[s-2][r]&&GameData.elements[GameData.mapData[s-1][r]].type==GameData.elements[GameData.mapData[s-2][r]].type&&(i=GameData.elements[GameData.mapData[s-1][r]].type),r>1&&-1!=GameData.mapData[s][r-1]&&-1!=GameData.mapData[s][r-2]&&GameData.elements[GameData.mapData[s][r-1]].type==GameData.elements[GameData.mapData[s][r-2]].type&&(n=GameData.elements[GameData.mapData[s][r-1]].type),e!=i&&e!=n&&(t=!1);a=GameData.unuseeElements[0],GameData.elements[a].type=e,GameData.elements[a].location=s*GameData.MaxRow+r,GameData.mapData[s][r]=a,GameData.unuseeElements.shift(),t=!0,i="",n=""}},e.prototype.createType=function(){return GameData.elementTyps[Math.floor(Math.random()*GameData.elementTyps.length)].toString()},e.prototype.changeTypeByID=function(e){GameData.elements[e].type=this.createType()},e.prototype.updateMapLocation=function(){for(var e=new Array,t=LinkLogic.lines.length,a=0;t>a;a++)for(var i=LinkLogic.lines[a].length,n=0;i>n;n++){for(var s=!1,r=e.length,m=0;r>m;m++)e[m]==LinkLogic.lines[a][n]&&(s=!0);s||(this.changeTypeByID(LinkLogic.lines[a][n]),e.push(LinkLogic.lines[a][n]))}t=e.length;var o=new Array;for(a=0;t>a;a++){for(s=!1,n=0;n<o.length;n++)o[n]==GameData.elements[e[a]].location%GameData.MaxColumn&&(s=!0);s||o.push(GameData.elements[e[a]].location%GameData.MaxColumn)}for(t=o.length,a=0;t>a;a++){var l=new Array,h=new Array;for(n=GameData.MaxRow-1;n>=0;n--){s=!1;for(var p=0;p<e.length;p++)e[p]==GameData.mapData[n][o[a]]&&(h.push(e[p]),s=!0);s||-1!=GameData.mapData[n][o[a]]&&l.push(GameData.mapData[n][o[a]])}for(l=l.concat(h),n=GameData.MaxRow-1;n>=0;n--)-1!=GameData.mapData[n][o[a]]&&(GameData.mapData[n][o[a]]=l[0],GameData.elements[l[0]].location=n*GameData.MaxRow+o[a],l.shift())}},e}();__reflect(MapControl.prototype,"MapControl");var MapDataParse=function(){function e(){}return e.createMapData=function(e){var t=e.length;GameData.unmapnum=t;for(var a=0,i=0;t>i;i++)a=e[i],GameData.mapData[Math.floor(a/GameData.MaxColumn)][a%GameData.MaxRow]=-1;GameData.currentElementNum=GameData.MaxColumn*GameData.MaxRow-t},e}();__reflect(MapDataParse.prototype,"MapDataParse");var PropLogic=function(){function e(){}return e.useProp=function(t,a){switch(t){case 0:e.tongse(a);break;case 1:e.zhadan(a);break;case 2:e.zhenghang(a);break;case 3:e.zhenglie(a);break;case 4:e.chanzi(a)}},e.chanzi=function(e){LinkLogic.lines=new Array,LinkLogic.lines.push([GameData.elements[GameData.mapData[Math.floor(e/8)][e%8]].id])},e.zhadan=function(e){LinkLogic.lines=new Array;var t=Math.floor(e/8),a=e%8,i=new Array;i.push(GameData.elements[GameData.mapData[t][a]].id),t>0&&-1!=GameData.mapData[t-1][a]&&i.push(GameData.elements[GameData.mapData[t-1][a]].id),t<GameData.MaxRow-1&&-1!=GameData.mapData[t+1][a]&&i.push(GameData.elements[GameData.mapData[t+1][a]].id),a>0&&-1!=GameData.mapData[t][a-1]&&i.push(GameData.elements[GameData.mapData[t][a-1]].id),a<GameData.MaxColumn-1&&-1!=GameData.mapData[t][a+1]&&i.push(GameData.elements[GameData.mapData[t][a+1]].id),LinkLogic.lines.push(i)},e.zhenghang=function(e){LinkLogic.lines=new Array;for(var t=new Array,a=Math.floor(e/8),i=0;i<GameData.MaxColumn;i++)-1!=GameData.mapData[a][i]&&(console.log(a,i),t.push(GameData.elements[GameData.mapData[a][i]].id));LinkLogic.lines.push(t)},e.zhenglie=function(e){LinkLogic.lines=new Array;for(var t=new Array,a=e%8,i=0;i<GameData.MaxRow;i++)-1!=GameData.mapData[i][a]&&t.push(GameData.elements[GameData.mapData[i][a]].id);LinkLogic.lines.push(t)},e.tongse=function(e){LinkLogic.lines=new Array;for(var t=new Array,a=GameData.elements[GameData.mapData[Math.floor(e/8)][e%8]].type,i=0;i<GameData.MaxRow;i++)for(var n=0;n<GameData.MaxColumn;n++)-1!=GameData.mapData[i][n]&&GameData.elements[GameData.mapData[i][n]].type==a&&t.push(GameData.elements[GameData.mapData[i][n]].id);LinkLogic.lines.push(t)},e}();__reflect(PropLogic.prototype,"PropLogic");var GameLogic=function(){function e(e){this._gameStage=e,this.init()}return e.prototype.init=function(){GameData.initData();var e=RES.getRes("l1");MapDataParse.createMapData(e.map),LevelGameDataParse.parseLevelGameData(e),this.mapc=new MapControl,this.mapc.createElementAllMap();var t=new GameBackGround;this._gameStage.addChild(t),t.changeBackground();var a=new egret.Sprite;this._gameStage.addChild(a),this.levm=new LevelReqViewManage(a),this.levm.createCurrentLevelReq();var i=new egret.Sprite;this._gameStage.addChild(i),this.pvm=new PropViewManage(i);var n=new egret.Sprite;this._gameStage.addChild(n),this.evm=new ElementViewManage(n),this.evm.showAllElement(),this.evm.addEventListener(ElementViewManageEvent.TAP_TWO_ELEMENT,this.viewTouchTap,this),this.evm.addEventListener(ElementViewManageEvent.REMOVE_ANIMATION_OVER,this.removeAniOver,this),this.evm.addEventListener(ElementViewManageEvent.UPDATE_MAP,this.createNewElement,this),this.evm.addEventListener(ElementViewManageEvent.UPDATE_VIEW_OVER,this.checkOtherElementLink,this),this.evm.addEventListener(ElementViewManageEvent.USE_PROP_CLICK,this.usePropClick,this)},e.prototype.viewTouchTap=function(e){var t=LinkLogic.canMove(e.ele1,e.ele2);if(console.log("位置上是否可以交换"+t,e.ele1,e.ele2),t){var a=LinkLogic.isHaveLineByIndex(GameData.elements[e.ele1].location,GameData.elements[e.ele2].location);console.log("移动后是否能消除",a),a?(console.log("消除动画"),this.evm.changeLocationAndScale(e.ele1,e.ele2),GameData.stepNum--,this.levm.updateStep()):this.evm.changeLocationAndBack(e.ele1,e.ele2)}else this.evm.setNewElementFocus(e.ele2)},e.prototype.removeAniOver=function(e){console.log("需要消除"+LinkLogic.lines);for(var t,a=LinkLogic.lines.length,i=0;a>i;i++)for(var n="",s=LinkLogic.lines[i].length,r=0;s>r;r++)if(n=GameData.elements[LinkLogic.lines[i][r]].type,t=this.levm.haveReqType(n)){var m=this.levm.getPointByType(n);GameData.levelreq.changeReqNum(n,1),this.levm.update(),this.evm.playReqRemoveAn(LinkLogic.lines[i][r],m.x,m.y)}else this.evm.playRemoveAni(LinkLogic.lines[i][r])},e.prototype.createNewElement=function(e){console.log("刷新地图数据！！！！！！！！"),this.mapc.updateMapLocation(),this.evm.updateMapData()},e.prototype.checkOtherElementLink=function(e){if(LinkLogic.isHaveLine())this.removeAniOver(null);else if(console.log("jiancha!"),!LinkLogic.isNextHaveLine()){for(var t=!1,a=!0;a;)console.log("执行乱序"),LinkLogic.changeOrder(),LinkLogic.isHaveLine()||LinkLogic.isNextHaveLine()&&(a=!1,t=!0);t&&this.evm.updateOrder()}console.log("所有动画逻辑结束"),this.isGameOver()},e.prototype.isGameOver=function(){console.log("道具是否清空",GameData.levelreq.isClear()),this.gameoverpanel||(0==GameData.stepNum?(this.gameoverpanel=new GameOverPanel,this._gameStage.addChild(this.gameoverpanel),GameData.levelreq.isClear()?this.gameoverpanel.show(!0):this.gameoverpanel.show(!1)):GameData.levelreq.isClear()&&(this.gameoverpanel=new GameOverPanel,this._gameStage.addChild(this.gameoverpanel),this.gameoverpanel.show(!0)))},e.prototype.usePropClick=function(e){PropLogic.useProp(PropViewManage.proptype,e.propToElementLocation),this.pvm.useProp(),this.removeAniOver(null)},e}();__reflect(GameLogic.prototype,"GameLogic");var GameElement=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id=0,t.location=0,t}return __extends(t,e),t.prototype.level=function(){},t}(BaseElement);__reflect(GameElement.prototype,"GameElement");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this.createGameScene())},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.createGameScene=function(){this._gameLayer=new egret.Sprite,this.addChild(this._gameLayer),this._gameLogic=new GameLogic(this._gameLayer)},t.prototype.acreateGameScene=function(){GameData.initData();var e=RES.getRes("l1");MapDataParse.createMapData(e.map),LevelGameDataParse.parseLevelGameData(e);var t=new MapControl;t.createElementAllMap(),console.log(GameData.mapData),console.log(GameData.elements);var a=new GameBackGround;this.addChild(a),a.changeBackground();var i=new egret.Sprite;this.addChild(i),this.evm=new ElementViewManage(i),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.click,this)},t.prototype.click=function(e){this.evm.showAllElement()},t.prototype.move=function(){for(var e=this.els.length,t=0,a=0,i=0,n=(GameData.stageW-40)/GameData.MaxColumn,s=0;e>s;s++)t=GameData.elements[Number(this.els[s].name)].location,i=GameData.stageH-(GameData.stageW-30)/6-60-n*GameData.MaxColumn+n*Math.floor(t/8),a=20+n*(t%8),egret.Tween.get(this.els[s]).to({x:a+n/2,y:i+n/2},700,egret.Ease.cubicInOut)},t.prototype.darwbitmap=function(){this.els=new Array,this.removeChildren(),this.bgc=new egret.Sprite,this.addChild(this.bgc);var e=new egret.Bitmap;e.texture=RES.getRes("background"),e.width=GameData.stageW,e.height=GameData.stageH,this.bgc.addChild(e);for(var t=(GameData.stageW-40)/GameData.MaxColumn,a=0;a<GameData.MaxRow;a++)for(var i=0;i<GameData.MaxColumn;i++)if(-1!=GameData.mapData[a][i]){var n=new egret.Bitmap;if(n.y=GameData.stageH-(GameData.stageW-30)/6-60-t*GameData.MaxColumn+t*a,n.x=20+t*i,n.width=t,n.height=t,this.bgc.addChild(n),0==a){var s=new egret.Bitmap;s.width=t,s.height=6,s.x=n.x,s.y=n.y-3,s.texture=RES.getRes("bianheng_jpg"),this.bgc.addChild(s)}if(a==GameData.MaxRow-1){var r=new egret.Bitmap;r.width=t,r.height=6,r.x=n.x,r.y=t+n.y+3,r.scaleY=-1,r.texture=RES.getRes("bianheng_jpg"),this.bgc.addChild(r)}if(0==i){var m=new egret.Bitmap;m.width=6,m.height=t,m.x=n.x-3,m.y=n.y,m.texture=RES.getRes("bianshu_jpg"),this.bgc.addChild(m)}if(i==GameData.MaxColumn-1){var o=new egret.Bitmap;o.width=6,o.height=t,o.x=t+n.x+3,o.y=n.y,o.texture=RES.getRes("bianshu_jpg"),o.scaleX=-1,this.bgc.addChild(o)}a%2==0&&i%2==0||a%2==1&&i%2==1?n.texture=RES.getRes("elementbg1"):n.texture=RES.getRes("elementbg2");var l=new egret.Sprite,h=new egret.Bitmap;h.texture=RES.getRes("e"+GameData.elements[GameData.mapData[a][i]].type+"_png"),h.width=n.width-10,h.height=n.height-10,h.x=-1*h.width/2,h.y=-1*h.height/2,l.addChild(h),l.x=n.x+n.width/2,l.y=n.y+n.height/2,l.cacheAsBitmap=!0,this.addChild(l),this.els.push(l),l.name=GameData.elements[GameData.mapData[a][i]].id.toString()}this.bgc.cacheAsBitmap=!0},t.prototype.drawd=function(){this.removeChildren();for(var e=16777215,t=0;t<GameData.MaxRow;t++)for(var a=0;a<GameData.MaxColumn;a++)if(-1!=GameData.mapData[t][a]){var i=new egret.Shape;switch(GameData.elements[GameData.mapData[t][a]].type){case"0":e=255;break;case"1":e=16711680;break;case"2":e=65280;break;case"3":e=16711935;break;case"4":e=65535;break;case"5":e=16777215}i.graphics.beginFill(e),i.graphics.lineStyle(1,0);var n=(GameData.stageW-40)/GameData.MaxColumn;i.graphics.drawRect(0,0,n,n),i.graphics.endFill(),i.y=GameData.stageH-(GameData.stageW-30)/6-60-n*GameData.MaxColumn+n*t,i.x=20+n*a,this.addChild(i)}for(var s=(GameData.stageW-60)/6,r=GameData.stageH-s-30,m=0;6>m;m++){var o=new egret.Shape;o.graphics.beginFill(65535),o.graphics.lineStyle(3,16711680),o.graphics.drawRect(0,0,s,s),o.graphics.endFill(),o.x=30+s*m,o.y=r,this.addChild(o)}},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var ElementViewManageEvent=function(e){function t(t,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1);var n=e.call(this,t,a,i)||this;return n.propToElementLocation=0,n.ele1=0,n.ele2=0,n}return __extends(t,e),t.TAP_TWO_ELEMENT="tap_two_element",t.REMOVE_ANIMATION_OVER="remove_animation_over",t.UPDATE_MAP="update_map",t.UPDATE_VIEW_OVER="update_view_over",t.USE_PROP_CLICK="use_prop_click",t}(egret.Event);__reflect(ElementViewManageEvent.prototype,"ElementViewManageEvent");var ElementView=function(e){function t(t){var a=e.call(this)||this;return a.location=0,a._id=-1,a._focus=!1,a.speed=700,a.thisparent=t,a.init(),a}return __extends(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.touchEnabled=!0,this.touchChildren=!1,this.bitmap=new egret.Bitmap;var e=(GameData.stageW-40)/GameData.MaxColumn;this.bitmap.width=e-10,this.bitmap.height=e-10,this.bitmap.x=-1*e/2,this.bitmap.y=-1*e/2,this.addChild(this.bitmap)},t.prototype.setTexture=function(e){this.bitmap.texture=RES.getRes(e)},Object.defineProperty(t.prototype,"focus",{get:function(){return this._focus},enumerable:!0,configurable:!0}),t.prototype.setFocus=function(e){if(e!=this._focus){if(this._focus=e,!this._focusMc){var t=RES.getRes("foucsmc_png"),a=RES.getRes("foucsmc_json"),i=new egret.MovieClipDataFactory(a,t);this._focusMc=new egret.MovieClip(i.generateMovieClipData("foucsmc")),this._focusMc.x=this._focusMc.width/-2,this._focusMc.y=this._focusMc.height/-2,this._focusMc.width=this.bitmap.width,this._focusMc.height=this.bitmap.height}e?(this.addChild(this._focusMc),this._focusMc.play(-1)):this._focusMc.parent&&(this._focusMc.stop(),this.removeChild(this._focusMc))}},t.prototype.move=function(){var e=egret.Tween.get(this);e.to({x:this.targetX(),y:this.targetY()},this.speed,egret.Ease.cubicInOut)},t.prototype.show=function(e){var t=egret.Tween.get(this);t.wait(e,!1),t.call(this.addThisToParent,this),t.to({x:this.targetX(),y:this.targetY()},this.speed,egret.Ease.bounceOut)},t.prototype.addThisToParent=function(){this.parent||this.thisparent.addChild(this)},t.prototype.targetX=function(){var e=(GameData.stageW-40)/GameData.MaxColumn,t=20+e*(this.location%GameData.MaxColumn)+e/2+5;return t},t.prototype.targetY=function(){var e=(GameData.stageW-40)/GameData.MaxColumn,t=GameData.stageH-(GameData.stageW-30)/6-60-e*GameData.MaxColumn,a=t+e*Math.floor(this.location/8)+e/2+5;return a},t.prototype.moveAndBack=function(e,t){void 0===t&&(t=!1);var a=(GameData.stageW-40)/GameData.MaxColumn,i=20+a*(e%GameData.MaxColumn)+a/2+5,n=GameData.stageH-(GameData.stageW-30)/6-60-a*GameData.MaxColumn,s=n+a*Math.floor(e/8)+a/2+5,r=egret.Tween.get(this);t?r.to({x:i,y:s,scaleX:1.2,scaleY:1.2},300,egret.Ease.cubicOut).call(this.back,this):r.to({x:i,y:s,scaleX:.8,scaleY:.8},300,egret.Ease.cubicOut).call(this.back,this)},t.prototype.back=function(){var e=egret.Tween.get(this);e.to({x:this.targetX(),y:this.targetY(),scaleX:1,scaleY:1},300,egret.Ease.cubicOut)},t.prototype.moveAndScale=function(e,t){void 0===t&&(t=!1);var a=(GameData.stageW-40)/GameData.MaxColumn,i=20+a*(e%GameData.MaxColumn)+a/2+5,n=GameData.stageH-(GameData.stageW-30)/6-60-a*GameData.MaxColumn,s=n+a*Math.floor(e/8)+a/2+5,r=egret.Tween.get(this);t?r.to({x:i,y:s,scaleX:1.4,scaleY:1.4},300,egret.Ease.cubicOut).call(this.backScale,this):r.to({x:i,y:s,scaleX:.6,scaleY:.6},300,egret.Ease.cubicOut).call(this.backScale,this)},t.prototype.backScale=function(){var e=egret.Tween.get(this);e.to({scaleX:1,scaleY:1},300,egret.Ease.backOut).call(this.canRemove,this)},t.prototype.canRemove=function(){var e=new ElementViewManageEvent(ElementViewManageEvent.REMOVE_ANIMATION_OVER);this.dispatchEvent(e)},t.prototype.playCurveMove=function(e,t){var a=egret.Tween.get(this);a.to({x:e,y:t},700,egret.Ease.quadOut).call(this.overCurveMove,this)},t.prototype.overCurveMove=function(){this.parent&&this.parent.removeChild(this);var e=new ElementViewManageEvent(ElementViewManageEvent.UPDATE_MAP);this.dispatchEvent(e)},t.prototype.playRemoveAni=function(){var e=egret.Tween.get(this);e.to({scaleX:1.4,scaleY:1.4},300,egret.Ease.cubicInOut).to({scaleX:.1,scaleY:.1},300,egret.Ease.cubicInOut).call(this.removeAniCall,this)},t.prototype.removeAniCall=function(){this.parent&&this.parent.removeChild(this);var e=new ElementViewManageEvent(ElementViewManageEvent.UPDATE_MAP);this.dispatchEvent(e)},t.prototype.moveNewLocation=function(){if(!this.parent){var e=(GameData.stageW-40)/GameData.MaxColumn,t=GameData.stageH-(GameData.stageW-30)/6-60-e*GameData.MaxColumn;this.y=t-this.width,this.scaleX=1,this.scaleY=1,this.x=this.targetX(),this.thisparent.addChild(this)}egret.Tween.get(this).to({x:this.targetX(),y:this.targetY()},this.speed,egret.Ease.bounceOut).call(this.moveNewLocationOver,this)},t.prototype.moveNewLocationOver=function(){var e=new ElementViewManageEvent(ElementViewManageEvent.UPDATE_VIEW_OVER);this.dispatchEvent(e)},t}(egret.Sprite);__reflect(ElementView.prototype,"ElementView");var ElementViewManage=function(e){function t(t){var a=e.call(this)||this;return a._currentTapID=-1,a.removenum=0,a.moveeleNum=0,a.moveLocElementNum=0,a._layer=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){this.elementviews=new Array;for(var e,t=GameData.MaxColumn*GameData.MaxRow,a=0;t>a;a++)e=new ElementView(this._layer),e.id=a,e.location=GameData.elements[a].location,this.elementviews.push(e),e.addEventListener(ElementViewManageEvent.REMOVE_ANIMATION_OVER,this.removeAniOver,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.elTap,this),e.addEventListener(ElementViewManageEvent.UPDATE_MAP,this.updateMap,this),e.addEventListener(ElementViewManageEvent.UPDATE_VIEW_OVER,this.moveNewLocationOver,this)},t.prototype.elTap=function(e){if(-1==PropViewManage.proptype){if(e.currentTarget instanceof ElementView){var t=e.currentTarget;if(-1!=this._currentTapID)if(t.id==this._currentTapID)t.setFocus(!1),this._currentTapID=-1;else{var a=new ElementViewManageEvent(ElementViewManageEvent.TAP_TWO_ELEMENT);a.ele1=this._currentTapID,a.ele2=t.id,this.dispatchEvent(a)}else t.setFocus(!0),this._currentTapID=t.id}}else{-1!=this._currentTapID&&(this._currentTapID=-1);var i=new ElementViewManageEvent(ElementViewManageEvent.USE_PROP_CLICK);i.propToElementLocation=e.currentTarget.location,this.dispatchEvent(i)}},t.prototype.setNewElementFocus=function(e){this.elementviews[this._currentTapID].setFocus(!1),this.elementviews[e].setFocus(!0),this._currentTapID=e},t.prototype.changeLocationAndBack=function(e,t){this.elementviews[e].focus?(this.elementviews[e].setFocus(!1),this._layer.getChildIndex(this.elementviews[e])<this._layer.getChildIndex(this.elementviews[t])&&this._layer.swapChildren(this.elementviews[e],this.elementviews[t]),this.elementviews[e].moveAndBack(this.elementviews[t].location,!0),this.elementviews[t].moveAndBack(this.elementviews[e].location)):(this.elementviews[t].setFocus(!1),this._layer.getChildIndex(this.elementviews[e])>this._layer.getChildIndex(this.elementviews[t])&&this._layer.swapChildren(this.elementviews[e],this.elementviews[t]),this.elementviews[e].moveAndBack(this.elementviews[t].location),this.elementviews[t].moveAndBack(this.elementviews[e].location,!0)),this._currentTapID=-1},t.prototype.changeLocationAndScale=function(e,t){this.elementviews[e].focus?(this.elementviews[e].setFocus(!1),this._layer.getChildIndex(this.elementviews[e])<this._layer.getChildIndex(this.elementviews[t])&&this._layer.swapChildren(this.elementviews[e],this.elementviews[t]),this.elementviews[e].moveAndScale(this.elementviews[t].location,!0),this.elementviews[t].moveAndScale(this.elementviews[e].location)):(this.elementviews[t].setFocus(!1),this._layer.getChildIndex(this.elementviews[e])>this._layer.getChildIndex(this.elementviews[t])&&this._layer.swapChildren(this.elementviews[e],this.elementviews[t]),this.elementviews[e].moveAndScale(this.elementviews[t].location),this.elementviews[t].moveAndScale(this.elementviews[e].location,!0)),this._currentTapID=-1},t.prototype.showAllElement=function(){this._layer.removeChildren();for(var e,t=(GameData.stageW-40)/GameData.MaxColumn,a=GameData.stageH-(GameData.stageW-30)/6-60-t*GameData.MaxColumn,i=0;i<GameData.MaxRow;i++)for(var n=0;n<GameData.MaxColumn;n++)-1!=GameData.mapData[i][n]&&(e=this.elementviews[GameData.mapData[i][n]],e.setTexture("e"+GameData.elements[GameData.mapData[i][n]].type+"_png"),e.x=e.targetX(),e.y=a-e.width,e.show(50*GameData.MaxColumn*GameData.MaxRow-50*GameData.unmapnum-50*(i*GameData.MaxRow+n)))},t.prototype.removeAniOver=function(e){this.removenum++,2==this.removenum&&(this.removenum=0,this.dispatchEvent(e))},t.prototype.playReqRemoveAn=function(e,t,a){this.moveeleNum++;var i=this.elementviews[e];i.parent&&this._layer.setChildIndex(i,this._layer.numChildren),i.playCurveMove(t,a)},t.prototype.playRemoveAni=function(e){this.moveeleNum++;var t=this.elementviews[e];t.parent&&this._layer.setChildIndex(t,this._layer.numChildren),t.playRemoveAni()},t.prototype.updateMap=function(e){this.moveeleNum--,0==this.moveeleNum&&this.dispatchEvent(e)},t.prototype.updateMapData=function(){console.log("重新布局");var e=this.elementviews.length;this.moveLocElementNum=0;for(var t=0;e>t;t++)this.elementviews[t].location=GameData.elements[t].location,this.elementviews[t].setTexture("e"+GameData.elements[t].type+"_png"),this.elementviews[t].moveNewLocation()},t.prototype.moveNewLocationOver=function(e){if(this.moveLocElementNum++,this.moveLocElementNum==GameData.MaxColumn*GameData.MaxRow){var t=new ElementViewManageEvent(ElementViewManageEvent.UPDATE_VIEW_OVER);
this.dispatchEvent(t)}},t.prototype.updateOrder=function(){var e=this.elementviews.length;egret.Tween.removeAllTweens();for(var t=0;e>t;t++)this.elementviews[t].location=GameData.elements[t].location,this.elementviews[t].move()},t}(egret.EventDispatcher);__reflect(ElementViewManage.prototype,"ElementViewManage");var GameBackGround=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.changeBackground=function(){this.cacheAsBitmap=!1,this.removeChildren(),this.createBackGroundImage(),this.createMapBg(),this.createLevelReqBg(),this.createStepBg(),this.cacheAsBitmap=!0},t.prototype.createBackGroundImage=function(){this.bgImage||(this.bgImage=new egret.Bitmap),this.bgImage.texture=RES.getRes(GameData.levelBackgrouindImageName),this.bgImage.width=GameData.stageW,this.bgImage.height=GameData.stageH,this.addChild(this.bgImage);var e=new egret.Bitmap;e.texture=RES.getRes("propbg_png"),e.width=GameData.stageW,e.height=GameData.stageW/5+20,e.y=GameData.stageH-e.height,this.addChild(e)},t.prototype.createMapBg=function(){this.girdBg||(this.girdBg=new Array);for(var e,t=(GameData.stageW-40)/GameData.MaxColumn,a=GameData.stageH-(GameData.stageW-30)/6-60-t*GameData.MaxColumn,i=0;i<GameData.MaxRow;i++)for(var n=0;n<GameData.MaxColumn;n++)-1!=GameData.mapData[i][n]&&(this.girdBg.length<i*GameData.MaxRow+n?(e=new egret.Bitmap,this.girdBg.push(e)):e=this.girdBg[i*GameData.MaxRow+n],e.width=t,e.height=t,e.x=20+t*n,e.y=a+t*i,i%2==0&&n%2==0||i%2==1&&n%2==1?e.texture=RES.getRes("elementbg1"):e.texture=RES.getRes("elementbg2"),this.addChild(e))},t.prototype.createLevelReqBg=function(){var e=(GameData.stageW-40)/GameData.MaxColumn,t=new egret.Bitmap;t.texture=RES.getRes("levelreqbg_png"),t.width=GameData.levelreq.getLevelReqNum()*(10+e)+20,t.height=e+60,t.x=20,t.y=50,this.addChild(t);var a=new egret.Bitmap;a.texture=RES.getRes("levelreqtitle_png"),a.x=t.x+(t.width-a.width)/2,a.y=t.y-18,this.addChild(a)},t.prototype.createStepBg=function(){var e=new egret.Bitmap;e.texture=RES.getRes("levelreqbg_png"),e.width=100,e.height=100,e.x=GameData.stageW-110,e.y=50,this.addChild(e);var t=new egret.Bitmap;t.texture=RES.getRes("sursteptitle_png"),t.x=e.x+(e.width-t.width)/2,t.y=e.y+10,this.addChild(t)},t}(egret.Sprite);__reflect(GameBackGround.prototype,"GameBackGround");var GameLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(egret.Sprite);__reflect(GameLayer.prototype,"GameLayer");var GameOverPanel=function(e){function t(){var t=e.call(this)||this;return t._issuccess=!1,t}return __extends(t,e),t.prototype.show=function(e){this._issuccess=e,this._view=new egret.Bitmap,this._view.texture=RES.getRes("levelreqbg_png"),this._view.width=GameData.stageW-30,this._view.height=GameData.stageH/2,this._view.x=this._view.width/-2,this._view.y=this._view.height/-2,this.addChild(this._view),this.x=GameData.stageW/2,this.y=GameData.stageH/2,this.scaleX=.1,this.skewY=.1,egret.Tween.get(this).to({scaleX:1,scaleY:1},700,egret.Ease.bounceOut).call(this.playStarAni,this)},t.prototype.playStarAni=function(){var e=new egret.Bitmap;if(e.texture=RES.getRes("gameovertitle_png"),e.width=this._view.width/2,e.height=60,e.x=this._view.x+(this._view.width-e.width)/2,e.y=this._view.y-10,e.scaleX=0,e.scaleY=0,this.addChild(e),egret.Tween.get(e).to({scaleX:1,scaleY:1},700,egret.Ease.bounceOut),console.log("播放结束动画"),this._issuccess){var t=new egret.Bitmap;t.texture=RES.getRes("chengzi_png"),t.width=(this._view.width-50)/3,t.height=t.width,t.x=(GameData.stageW-2*t.width)/3+this._view.x,t.y=150+this._view.y,t.scaleX=1.5,t.scaleY=1.5,t.alpha=0,this.addChild(t),egret.Tween.get(t).to({scaleX:1,scaleY:1,alpha:1},700,egret.Ease.circIn);var a=new egret.Bitmap;a.texture=RES.getRes("gongzi_png"),a.width=(this._view.width-50)/3,a.height=a.width,a.x=(GameData.stageW-2*a.width)/3*2+a.width+this._view.x,a.y=150+this._view.y,a.scaleX=1.5,a.scaleY=1.5,a.alpha=0,this.addChild(a),egret.Tween.get(a).wait(400).to({scaleX:1,scaleY:1,alpha:1},700,egret.Ease.circIn)}else{var i=new egret.Bitmap;i.texture=RES.getRes("shizi_png"),i.width=(this._view.width-50)/3,i.height=i.width,i.x=(GameData.stageW-2*i.width)/3+this._view.x,i.y=150+this._view.y,i.scaleX=1.5,i.skewY=1.5,i.alpha=0,this.addChild(i),egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},700,egret.Ease.circIn);var n=new egret.Bitmap;n.texture=RES.getRes("baizi_png"),n.width=(this._view.width-50)/3,n.height=n.width,n.x=(GameData.stageW-2*n.width)/3*2+n.width+this._view.x,n.y=150+this._view.y,n.scaleX=1.5,n.scaleY=1.5,n.alpha=0,this.addChild(n),egret.Tween.get(n).wait(400).to({scaleX:1,scaleY:1,alpha:1},700,egret.Ease.circIn)}},t}(egret.Sprite);__reflect(GameOverPanel.prototype,"GameOverPanel");var LevelElementView=function(e){function t(){var t=e.call(this)||this;return t.eltype="",t.init(),t}return __extends(t,e),Object.defineProperty(t.prototype,"num",{get:function(){return Number(this.bittext.text)},set:function(e){0>=e?this.checkmarkbit||(this.checkmarkbit=new egret.Bitmap,this.checkmarkbit.texture=RES.getRes("checkmark_png"),this.checkmarkbit.x=(this.bitmap.width-this.checkmarkbit.width)/2,this.checkmarkbit.y=this.bitmap.height+this.bitmap.y-this.checkmarkbit.height/2,this.addChild(this.checkmarkbit),this.removeChild(this.bittext)):this.bittext.text=e.toString()},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.touchEnabled=!1,this.bitmap||(this.bitmap=new egret.Bitmap);var e=(GameData.stageW-40)/GameData.MaxColumn;this.bitmap.width=e,this.bitmap.height=e,this.addChild(this.bitmap),this.bittext=new egret.BitmapText,this.bittext.font=RES.getRes("number_fnt"),this.bittext.text="0",this.bittext.x=(e-this.bittext.width)/2,this.bittext.y=this.bitmap.height+this.bitmap.y-this.bittext.height/2,this.addChild(this.bittext)},t.prototype.setTexture=function(e){this.bitmap.texture=RES.getRes(e)},t}(egret.Sprite);__reflect(LevelElementView.prototype,"LevelElementView");var LevelReqViewManage=function(){function e(e){this._layer=e,this.init()}return e.prototype.init=function(){this.elements=new Array},e.prototype.createCurrentLevelReq=function(){for(var e,t=GameData.levelreq.getLevelReqNum(),a=0;t>a;a++)this.elements.length<=a?(e=new LevelElementView,this.elements.push(e)):e=this.elements[a],e.eltype=GameData.levelreq.reqElements[a].type,e.setTexture("e"+e.eltype+"_png"),e.x=43+(5+e.width)*a,e.y=95,e.num=GameData.levelreq.reqElements[a].num,this._layer.addChild(e);this.stepNumText||(this.stepNumText=new egret.BitmapText,this.stepNumText.font=RES.getRes("number_fnt"),this.stepNumText.x=GameData.stageW-95,this.stepNumText.y=90,this.stepNumText.scaleX=1.5,this.stepNumText.scaleY=1.5,this._layer.addChild(this.stepNumText),this.stepNumText.text=GameData.stepNum.toString())},e.prototype.haveReqType=function(e){for(var t=this.elements.length,a=0;t>a;a++)if(this.elements[a].eltype==e)return!0;return!1},e.prototype.getPointByType=function(e){for(var t=new egret.Point,a=this.elements.length,i=0;a>i;i++)this.elements[i].eltype==e&&(t.x=this.elements[i].x+this.elements[i].width/2,t.y=this.elements[i].y+this.elements[i].height/2);return t},e.prototype.update=function(){for(var e=GameData.levelreq.getLevelReqNum(),t=0;e>t;t++)this.elements[t].num=GameData.levelreq.reqElements[t].num},e.prototype.updateStep=function(){this.stepNumText.text=GameData.stepNum.toString()},e}();__reflect(LevelReqViewManage.prototype,"LevelReqViewManage");var PropView=function(e){function t(t){var a=e.call(this)||this;return a._type=-1,a.id=-1,a._num=0,a._type=t,a.init(),a}return __extends(t,e),Object.defineProperty(t.prototype,"proptype",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.createView(),this.createNumText(),this.addChild(this._view_activate),this.addChild(this._view_box),this.addChild(this._numText),this.setActivateState(!0)},t.prototype.createNumText=function(){this._numText=new egret.BitmapText,this._numText.font=RES.getRes("number_fnt"),this._numText.x=this._view_activate.width-31},t.prototype.createView=function(){var e=15,t=(GameData.stageW-6*e)/5;this._view_activate||(this._view_activate=new egret.Bitmap,this._view_activate.texture=RES.getRes(this.getActivateTexture(this._type)),this._view_activate.width=t,this._view_activate.height=t),this._view_box||(this._view_box=new egret.Bitmap,this._view_box.texture=RES.getRes("propbox_png"),this._view_box.width=this._view_activate.width+10,this._view_box.height=this._view_activate.height+10,this._view_box.x=-5,this._view_box.y=-5)},Object.defineProperty(t.prototype,"num",{get:function(){return this._num},set:function(e){this._num=e,this._numText.text=e.toString(),0>=e?this.setActivateState(!1):this.setActivateState(!0)},enumerable:!0,configurable:!0}),t.prototype.setActivateState=function(e){this.touchEnabled=e,e?(this._view_activate.texture=RES.getRes(this.getActivateTexture(this._type)),this._view_box.texture=RES.getRes("propbox_png"),this._numText.font=RES.getRes("number_fnt")):(this._view_activate.texture=RES.getRes(this.getDisableTexture(this._type)),this._view_box.texture=RES.getRes("propboxdisable_png"),this._numText.font=RES.getRes("numberdisable_fnt"))},t.prototype.getActivateTexture=function(e){var t="";switch(e){case 0:t="tongse_png";break;case 1:t="zhadan_png";break;case 2:t="zhenghang_png";break;case 3:t="zhenglie_png";break;case 4:t="chanzi_png"}return t},t.prototype.getDisableTexture=function(e){var t="";switch(e){case 0:t="tongsedisable_png";break;case 1:t="zhadandisable_png";break;case 2:t="zhenghangdisable_png";break;case 3:t="zhengliedisable_png";break;case 4:t="chanzidisable_png"}return t},t.prototype.setFocus=function(e){e?this._view_box.texture=RES.getRes("propboxactive_png"):this._view_box.texture=RES.getRes("propbox_png")},t}(egret.Sprite);__reflect(PropView.prototype,"PropView");var PropViewManage=function(){function e(e){this._currentID=-1,this._layer=e,this.init()}return e.prototype.init=function(){this._props=new Array,this.createdata()},e.prototype.createdata=function(){for(var e=0;5>e;e++){var t=new PropView(e);t.x=15+(5+t.width)*e,console.log("道具宽度",t.width),t.y=GameData.stageH-t.height-10,this._layer.addChild(t),this._props.push(t),t.num=Math.floor(5*Math.random()),t.id=e,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)}},e.prototype.click=function(t){-1!=this._currentID?(this._props[this._currentID].setFocus(!1),this._currentID==t.currentTarget.id?(this._currentID=-1,e.proptype=-1):(this._currentID=t.currentTarget.id,this._props[this._currentID].setFocus(!0),e.proptype=this._props[this._currentID].proptype)):(this._currentID=t.currentTarget.id,this._props[this._currentID].setFocus(!0),e.proptype=this._props[this._currentID].proptype)},e.prototype.useProp=function(){console.log("当前焦点ID",this._currentID),this._props[this._currentID].num--,this._props[this._currentID].setFocus(!1),this._currentID=-1,e.proptype=-1},e.proptype=-1,e}();__reflect(PropViewManage.prototype,"PropViewManage");